<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Đặt Khám Bác Sĩ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e0f2f1 0%, #b3e5fc 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #00897b;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        /* Controls */
        .controls {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .controls-right {
            display: flex;
            gap: 10px;
        }

        .date-input {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .date-input:focus {
            border-color: #00897b;
        }

        .btn {
            padding: 10px 20px;
            background: #00897b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #00796b;
        }

        .btn-nav {
            padding: 10px 15px;
            min-width: auto;
        }

        /* Calendar */
        .calendar-wrapper {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .calendar-container {
            overflow-x: auto;
        }

        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        .calendar-table thead {
            background: #00897b;
            color: white;
        }

        .calendar-table th {
            padding: 15px;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid #00796b;
            min-width: 180px;
        }

        .calendar-table th:first-child {
            text-align: left;
            min-width: 150px;
        }

        .calendar-table th:last-child {
            border-right: none;
        }

        .calendar-table th.today {
            background: #ff9800;
        }

        .day-header {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .date-header {
            font-size: 13px;
            font-weight: normal;
            opacity: 0.9;
        }

        .calendar-table td {
            padding: 12px;
            vertical-align: top;
            border-right: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            min-height: 120px;
        }

        .calendar-table td:last-child {
            border-right: none;
        }

        .calendar-table td.today-cell {
            background: #fff3e0;
        }

        .time-slot {
            background: #00897b;
            color: white;
            font-weight: 600;
            padding: 15px 12px;
        }

        .time-slot .period {
            font-size: 14px;
            margin-bottom: 3px;
        }

        .time-slot .time-range {
            font-size: 11px;
            opacity: 0.9;
            font-weight: normal;
        }

        /* Appointment Card */
        .appointment-card {
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .appointment-card:last-child {
            margin-bottom: 0;
        }

        .appointment-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .appointment-card.confirmed {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }

        .appointment-card.pending {
            background: #fff9c4;
            border-left-color: #fbc02d;
        }

        .appointment-card.completed {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }

        .appointment-card.cancelled {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .card-title {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            line-height: 1.4;
            flex: 1;
        }

        .card-details {
            font-size: 12px;
            color: #555;
            line-height: 1.8;
        }

        .card-detail {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 3px;
        }

        .card-detail svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            color: #666;
        }

        .card-detail strong {
            color: #333;
            margin-right: 4px;
        }

        .status-badge {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }

        .status-badge.confirmed {
            background: #2196f3;
        }

        .status-badge.pending {
            background: #fbc02d;
            color: #333;
        }

        .status-badge.completed {
            background: #4caf50;
        }

        .status-badge.cancelled {
            background: #f44336;
        }

        /* Legend */
        .legend {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }

        .legend h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-text {
            font-size: 14px;
            color: #555;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls-left,
            .controls-right {
                width: 100%;
                justify-content: center;
            }

            .header h1 {
                font-size: 24px;
            }

            .calendar-table {
                min-width: 1200px;
            }
        }

        /* Empty slot */
        .empty-slot {
            color: #999;
            font-size: 12px;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Lịch Đặt Khám Bác Sĩ</h1>
            <p>Quản lý lịch hẹn và theo dõi trạng thái khám bệnh</p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-left">
                <input type="date" class="date-input" id="dateInput" value="2025-10-21">
                <button class="btn" onclick="goToToday()">
                    <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    HIỆN TẠI
                </button>
            </div>
            <div class="controls-right">
                <button class="btn btn-nav" onclick="previousWeek()">
                    <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <button class="btn btn-nav" onclick="nextWeek()">
                    <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Calendar -->
        <div class="calendar-wrapper">
            <div class="calendar-container">
                <table class="calendar-table" id="calendarTable">
                    <!-- Table will be generated by JavaScript -->
                </table>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <h3>Trạng thái lịch hẹn:</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196f3;"></div>
                    <span class="legend-text">Đã xác nhận</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fbc02d;"></div>
                    <span class="legend-text">Đang chờ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4caf50;"></div>
                    <span class="legend-text">Hoàn thành</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f44336;"></div>
                    <span class="legend-text">Đã hủy</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Current date state
        let currentDate = new Date(2025, 9, 21); // October 21, 2025

        // Sample data - Dữ liệu mẫu theo yêu cầu
        const appointmentsData = {
            '2025-10-21': {
                morning: [
                    {
                        id: 1,
                        doctorName: 'BS. Nguyễn Văn A',
                        specialty: 'Tim mạch',
                        time: '08:00 - 09:00',
                        location: 'Phòng khám Tim mạch - Tầng 2',
                        status: 'confirmed'
                    },
                    {
                        id: 2,
                        doctorName: 'BS. Trần Thị B',
                        specialty: 'Nội khoa',
                        time: '09:30 - 10:30',
                        location: 'Phòng 201 - Tầng 2',
                        status: 'pending'
                    }
                ],
                afternoon: [
                    {
                        id: 3,
                        doctorName: 'BS. Lê Văn C',
                        specialty: 'Da liễu',
                        time: '13:00 - 14:00',
                        location: 'Phòng 305 - Tầng 3',
                        status: 'confirmed'
                    }
                ],
                evening: [
                    {
                        id: 4,
                        doctorName: 'BS. Phạm Thị D',
                        specialty: 'Răng hàm mặt',
                        time: '17:00 - 18:00',
                        location: 'Phòng nha khoa - Tầng 1',
                        status: 'completed'
                    }
                ]
            },
            '2025-10-22': {
                morning: [
                    {
                        id: 5,
                        doctorName: 'BS. Hoàng Văn E',
                        specialty: 'Tai mũi họng',
                        time: '08:30 - 09:30',
                        location: 'Phòng 102 - Tầng 1',
                        status: 'pending'
                    }
                ],
                noon: [
                    {
                        id: 6,
                        doctorName: 'BS. Đỗ Thị F',
                        specialty: 'Sản phụ khoa',
                        time: '11:00 - 12:00',
                        location: 'Phòng 401 - Tầng 4',
                        status: 'confirmed'
                    }
                ],
                evening: []
            },
            '2025-10-23': {
                morning: [],
                afternoon: [
                    {
                        id: 7,
                        doctorName: 'BS. Vũ Văn G',
                        specialty: 'Thần kinh',
                        time: '14:00 - 15:00',
                        location: 'Phòng 203 - Tầng 2',
                        status: 'cancelled'
                    }
                ],
                evening: [
                    {
                        id: 8,
                        doctorName: 'BS. Bùi Thị H',
                        specialty: 'Nội tiết',
                        time: '18:30 - 19:30',
                        location: 'Phòng 304 - Tầng 3',
                        status: 'confirmed'
                    }
                ]
            }
        };

        // Time slots with time ranges
        const timeSlots = [
            { label: 'Sáng', key: 'morning', time: '07:00 - 11:00' },
            { label: 'Trưa', key: 'noon', time: '11:00 - 13:00' },
            { label: 'Chiều', key: 'afternoon', time: '13:00 - 17:00' },
            { label: 'Tối', key: 'evening', time: '17:00 - 21:00' }
        ];

        // Utility functions
        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function getDateKey(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function getWeekDays(date) {
            const curr = new Date(date);
            const first = curr.getDate() - curr.getDay() + 1;
            const days = [];
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(curr);
                day.setDate(first + i);
                days.push(day);
            }
            return days;
        }

        function getDayName(dayNum) {
            if (dayNum === 0) return 'CN';
            return dayNum + 1;
        }

        function getStatusText(status) {
            const statusMap = {
                'confirmed': 'Đã xác nhận',
                'pending': 'Đang chờ',
                'completed': 'Hoàn thành',
                'cancelled': 'Đã hủy'
            };
            return statusMap[status] || '';
        }

        // Create appointment card HTML
        function createAppointmentCard(appointment) {
            return `
                <div class="appointment-card ${appointment.status}">
                    <div class="card-header">
                        <div class="card-title">${appointment.doctorName}</div>
                    </div>
                    <div class="card-details">
                        <div class="card-detail">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span><strong>Chuyên khoa:</strong> ${appointment.specialty}</span>
                        </div>
                        <div class="card-detail">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span><strong>Thời gian:</strong> ${appointment.time}</span>
                        </div>
                        <div class="card-detail">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span><strong>Địa điểm:</strong> ${appointment.location}</span>
                        </div>
                    </div>
                    <span class="status-badge ${appointment.status}">${getStatusText(appointment.status)}</span>
                </div>
            `;
        }

        // Render calendar
        function renderCalendar() {
            const weekDays = getWeekDays(currentDate);
            const table = document.getElementById('calendarTable');
            
            // Create header
            let headerHTML = '<thead><tr><th>Buổi khám</th>';
            weekDays.forEach(day => {
                const todayClass = isToday(day) ? 'today' : '';
                headerHTML += `
                    <th class="${todayClass}">
                        <div class="day-header">Thứ ${getDayName(day.getDay())}</div>
                        <div class="date-header">${formatDate(day)}</div>
                    </th>
                `;
            });
            headerHTML += '</tr></thead>';

            // Create body
            let bodyHTML = '<tbody>';
            timeSlots.forEach((slot) => {
                bodyHTML += '<tr>';
                bodyHTML += `
                    <td class="time-slot">
                        <div class="period">${slot.label}</div>
                        <div class="time-range">${slot.time}</div>
                    </td>
                `;
                
                weekDays.forEach(day => {
                    const dateKey = getDateKey(day);
                    const dayAppointments = appointmentsData[dateKey];
                    const slotAppointments = dayAppointments ? dayAppointments[slot.key] || [] : [];
                    const todayClass = isToday(day) ? 'today-cell' : '';
                    
                    bodyHTML += `<td class="${todayClass}">`;
                    if (slotAppointments.length > 0) {
                        slotAppointments.forEach(appointment => {
                            bodyHTML += createAppointmentCard(appointment);
                        });
                    } else {
                        bodyHTML += '<div class="empty-slot">Không có lịch hẹn</div>';
                    }
                    bodyHTML += '</td>';
                });
                
                bodyHTML += '</tr>';
            });
            bodyHTML += '</tbody>';

            table.innerHTML = headerHTML + bodyHTML;
        }

        // Navigation functions
        function previousWeek() {
            currentDate.setDate(currentDate.getDate() - 7);
            updateDateInput();
            renderCalendar();
        }

        function nextWeek() {
            currentDate.setDate(currentDate.getDate() + 7);
            updateDateInput();
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            updateDateInput();
            renderCalendar();
        }

        function updateDateInput() {
            const dateInput = document.getElementById('dateInput');
            dateInput.value = getDateKey(currentDate);
        }

        // Date input change handler
        document.getElementById('dateInput').addEventListener('change', function(e) {
            currentDate = new Date(e.target.value);
            renderCalendar();
        });

        // Initial render
        renderCalendar();

        /*
        ===================================================
        BACKEND API INTEGRATION GUIDE
        ===================================================
        
        1. API Endpoint để lấy lịch hẹn:
        GET /api/appointments?startDate=YYYY-MM-DD&endDate=YYYY-MM-DD&userId={userId}
        
        2. Cấu trúc dữ liệu trả về từ Backend:
        {
            "2025-10-21": {
                "morning": [
                    {
                        "id": 1,
                        "doctorName": "BS. Nguyễn Văn A",
                        "specialty": "Tim mạch",
                        "time": "08:00 - 09:00",
                        "location": "Phòng khám Tim mạch - Tầng 2",
                        "status": "confirmed"
                    }
                ],
                "noon": [],
                "afternoon": [...],
                "evening": [...]
            },
            "2025-10-22": {...}
        }
        
        3. Các trạng thái hợp lệ:
        - "pending": Đang chờ xác nhận
        - "confirmed": Đã xác nhận
        - "completed": Hoàn thành
        - "cancelled": Đã hủy
        
        4. Hàm fetch dữ liệu từ Backend:
        
        async function fetchAppointments(startDate, endDate) {
            try {
                const response = await fetch(
                    `/api/appointments?startDate=${startDate}&endDate=${endDate}`,
                    {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('token'),
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error('Failed to fetch appointments');
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching appointments:', error);
                return {};
            }
        }
        
        5. Tích hợp vào hàm render:
        
        async function renderCalendar() {
            const weekDays = getWeekDays(currentDate);
            const startDate = getDateKey(weekDays[0]);
            const endDate = getDateKey(weekDays[6]);
            
            // Fetch từ API
            const data = await fetchAppointments(startDate, endDate);
            
            // Cập nhật dữ liệu
            Object.assign(appointmentsData, data);
            
            // Render calendar như bình thường...
        }
        
        6. API đặt lịch hẹn mới:
        POST /api/appointments
        Body: {
            "doctorId": 123,
            "date": "2025-10-21",
            "timeSlot": "morning",
            "time": "08:00 - 09:00"
        }
        
        7. API cập nhật trạng thái:
        PATCH /api/appointments/{id}/status
        Body: {
            "status": "confirmed" | "cancelled" | "completed"
        }
        
        8. API hủy lịch hẹn:
        DELETE /api/appointments/{id}
        
        ===================================================
        */
    </script>
</body>
</html>